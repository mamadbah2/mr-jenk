# MongoDB Configuration
export MONGODB_URI="mongodb+srv://mamadbah:$Atlas2022@cluster0.wlwhrhg.mongodb.net/?appName=Cluster0"
export MONGODB_DATABASE="z01"

# Supabase Configuration
export SUPABASE_PROJECT_URL="https://mwkrwffquzzsvssigsup.supabase.co"
export SUPABASE_API_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im13a3J3ZmZxdXp6c3Zzc2lnc3VwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NTkzMDIsImV4cCI6MjA2NjMzNTMwMn0.5TeZ-h0zKCc5W2KUbP1R_nU7PZNaMbrVcOK59tmjVvU"
export SUPABASE_BUCKET_NAME="media-service"
#!/bin/bash

# Script pour gÃ©nÃ©rer le fichier application.properties pour les tests locaux
# Ce script utilise les variables d'environnement pour crÃ©er le fichier de configuration

CONFIG_FILE="src/test/resources/application.properties"

echo "ðŸ”§ GÃ©nÃ©ration du fichier de configuration pour les tests..."

# VÃ©rifier que toutes les variables requises sont dÃ©finies
REQUIRED_VARS=("MONGODB_URI" "MONGODB_DATABASE" "SUPABASE_PROJECT_URL" "SUPABASE_API_KEY" "SUPABASE_BUCKET_NAME")
MISSING_VARS=()

for var in "${REQUIRED_VARS[@]}"; do
    if [ -z "${!var}" ]; then
        MISSING_VARS+=("$var")
    fi
done

if [ ${#MISSING_VARS[@]} -gt 0 ]; then
    echo "âŒ Erreur : Les variables d'environnement suivantes ne sont pas dÃ©finies :"
    for var in "${MISSING_VARS[@]}"; do
        echo "   - $var"
    done
    echo ""
    echo "ðŸ’¡ Pour dÃ©finir ces variables, vous pouvez :"
    echo "   1. Les exporter dans votre shell :"
    echo "      export MONGODB_URI=\"votre_uri\""
    echo ""
    echo "   2. Ou crÃ©er un fichier .env et le sourcer :"
    echo "      source .env"
    exit 1
fi

# CrÃ©er le rÃ©pertoire si nÃ©cessaire
mkdir -p src/test/resources

# GÃ©nÃ©rer le fichier de configuration
cat > "$CONFIG_FILE" << EOF
# Database configuration
spring.data.mongodb.uri=${MONGODB_URI}
spring.data.mongodb.database=${MONGODB_DATABASE}

# Max file size per upload
spring.servlet.multipart.max-file-size=2MB

# Max total request size (important if multiple files/fields)
spring.servlet.multipart.max-request-size=2MB

# Supabase configuration
supabase.project-url=${SUPABASE_PROJECT_URL}
supabase.api-key=${SUPABASE_API_KEY}
supabase.bucket-name=${SUPABASE_BUCKET_NAME}

# Server configuration
server.port=8083
# Media Service Configuration
spring.application.name=media-service

spring.config.import=optional:configserver:\${DOCKER_CONFIG_SERVICE_URL:http://localhost:8888}

# eureka.client.serviceUrl.defaultZone=\${DOCKER_EUREKA_URL:http://localhost:8761/eureka}

management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=always
management.server.port=8083

# File upload configuration
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.location=/tmp
spring.servlet.multipart.enabled=true
spring.servlet.multipart.resolve-lazily=false

# Custom file upload limits and security
file.upload.max-files=5
file.upload.max-file-size=5242880
file.upload.allowed-types=image/jpeg,image/jpg,image/png,image/webp,image/gif
file.upload.max-filename-length=255
file.upload.secure-filenames=true

# Media storage configuration
media.storage.path=/tmp/media
media.storage.cleanup-on-startup=false

# Security headers for file uploads
server.servlet.session.tracking-modes=cookie
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
EOF

echo "âœ… Fichier $CONFIG_FILE gÃ©nÃ©rÃ© avec succÃ¨s !"
echo ""
echo "Vous pouvez maintenant lancer les tests avec : mvn test"

